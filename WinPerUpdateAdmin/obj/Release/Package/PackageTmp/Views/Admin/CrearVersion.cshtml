<div class="row">
    <div class="col-md-12">
        <h1>Detalles de la Versi&oacute;n</h1>
        <ol class="breadcrumb autoscroll">
            <li><a href="/Admin#/">Versiones</a></li>
            <li class="active">Una Versi&oacute;n</li>
        </ol>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="btn-toolbar hidden-xs">
                <div class="btn-group" role="toolbar">
                    

                    <button ng-click="ShowConfirmPublish()" ng-disabled="formData.estado=='C' || formData.estado=='P'" data-toggle="modal" class="btn btn-default" ng-hide="idversion==0">
                        <span class="fa fa-fw fa-square-o" ng-show="formData.estado=='N'"></span><span class="fa fa-fw fa-check-square-o" ng-show="formData.estado=='P'"></span> Publicar
                    </button>

                    <a ng-click="ShowConfirm()" data-toggle="modal" class="btn btn-danger" ng-hide="idversion==0">
                        <span class="fa fa-fw fa-trash-o"></span> Eliminar
                    </a>

                    <button ng-click="PublicarParcial(idversion)" class="btn btn-info" ng-hide="idversion==0 || formData.estado!='N'">
                        <span class="fa fa-fw fa-bullhorn"></span> Publicar Parcialmente
                    </button>
                </div>
            </div>

            <div class="btn-toolbar visible-xs-block">
                <div class="btn-group" role="toolbar">
                    <div class="btn-group" role="group">
                        <button type="button" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                            <span class="fa fa-fw fa-binoculars"></span> Actions <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li>
                                <a ng-click="ShowConfirmPublish()" ng-disabled="formData.estado=='C'" data-toggle="modal" ng-hide="idversion==0">
                                    <span class="fa fa-square-o" ng-show="formData.estado=='N'"></span><span class="fa fa-fw fa-check-square-o" ng-show="formData.estado=='P'"></span> Publicado
                                </a>
                            </li>

                            <li>
                                <a ng-click="ShowConfirm()" data-toggle="modal" ng-hide="idversion==0">
                                    <span class="text-danger"><span class="fa fa-fw fa-trash-o"></span> Eliminar Versi&oacute;n</span>
                                </a>
                            </li>

                            <li>
                                <a href="Admin#/PublicarParcial/{{idversion}}" class="btn btn-info" ng-hide="idversion==0 || formData.estado!='N'">
                                    <span class="fa fa-fw fa-bullhorn"></span> Publicar Parcialmente
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">{{titulo}}</h3>
                </div>

                <div class="panel-body">
                    <form name="frmMain" method="post" action="#" novalidate>
                        <div class="form-group">
                            <div class="input-group margin-bottom-sm">
                                <span class="input-group-addon" title="Release"><i class="fa fa-tablet fa-fw"></i></span>
                                <input class="form-control" type="text" name="name" ng-disabled="btnBlock" placeholder="Release" ng-model="formData.release" required="required" ng-maxlength="100" ng-model-options="{ updateOn: 'blur' }">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button" ng-click="btnBlock = !btnBlock"><i class="fa fa-pencil fa-fw"></i></button>
                                    <button class="btn btn-default" type="button" ng-click="AumentarRelease(formData)"><i class="fa fa-plus fa-fw"></i></button>
                                </span>
                            </div>
                            <span class="error_ingreso" ng-show="frmMain.name.$error.maxlength">
                                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Largo máximo no debe superar los 100 carácteres
                            </span>
                        </div>

                        <div class="form-group">
                            <div class="input-group date" id='datepicker'>
                                <span class="input-group-addon" title="Fecha"><i class="fa fa-calendar-o fa-fw"></i></span>
                                <input class="form-control" id="fecha" value="{{formData.fecha}}" type="text" name="fecha" placeholder="fecha" ng-model="formData.fecha" required="required" ng-maxlength="10" ng-model-options="{ updateOn: 'blur' }">
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-group margin-bottom-sm">
                                <span class="input-group-addon" title="Comentario"><i class="fa fa-comment-o fa-fw"></i></span>
                                <textarea class="form-control" rows="5" name="comentario" placeholder="Comentario" ng-model="formData.comentario" ng-maxlength="2048" ng-model-options="{ updateOn: 'blur' }"></textarea>
                            </div>
                            <span class="error_ingreso" ng-show="frmMain.comentario.$error.maxlength">
                                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Largo máximo no debe superar los 2048 carácteres
                            </span>

                        </div>

                        <hr />

                        <button type="button" class="btn btn-primary btn-block" ng-click="frmMain.$valid && SaveVersion(formData)" ng-disabled="!increate">
                            <span class="fa fa-check" ng-show="increate"></span>
                            <span class="fa fa-circle-o-notch fa-spin" ng-hide="increate"></span> {{labelcreate}}
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-md-12">
            <h1>Componentes</h1>

            <div class="container" ng-hide="idversion==0">
                <div class="row">
                    <div class="col-md-12">
                        <div class="btn-toolbar" role="toolbar">
                            <div class="btn-toolbar" role="toolbar">
                                <a href="/Admin#/CrearComponente/{{idversion}}" ng-disabled="formData.estado=='C'" class="btn btn-labeled btn-success">
                                    <span class="btn-label"><span class="fa fa-cubes"></span></span> Asignar Componente
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />

            <div class="row" ng-repeat="tipoComp in TipoComponentes">
                <button data-toggle="collapse" class="btn btn-default btn-block" data-target="#{{$index}}">{{tipoComp.Tipo.Nombre}}</button>
                
                <br />
                <div id="{{$index}}" class="collapse">
                    <div class="col-md-4 col-sm-4 col-xs-12" ng-repeat="ejecutable in componentes | filtroComponente: tipoComp.Tipo.Extensiones" >
                        <div class="item panel panel-{{ejecutable.isOk}}">
                            <div class="panel-heading">
                                <h3 class="panel-title single-line">{{ejecutable.componente.Name}}</h3>
                            </div>
                            <div class="panel-body">
                                <img src="~/Content/Images/Run.png" alt="" class="avatar img-thumbnail image-foto" />
                                <div class="pull-right" style="width: 50%">
                                    <ul class="list-unstyled">
                                        <li><span class="fa fa-fw fa-cube"></span> {{ejecutable.componente.Modulo}}</li>
                                        <li><span class="fa fa-fw fa-calendar"></span> {{ejecutable.componente.DateCreateFmt}}</li>
                                        <li><span class="fa fa-fw fa-bug"></span> {{ejecutable.componente.Version}}</li>
                                        <li>
                                            <div ng-hide="ejecutable.isOk == 'success'" class="alert alert-{{ejecutable.isOk}}">
                                                <span class="fa fa-fw fa-exclamation-triangle"></span>
                                                <a href="" data-toggle="tooltip" title="{{ejecutable.componente.MensajeToolTip}}">
                                                    Más Información
                                                </a>
                                            </div>
                                            <script>
                                                $(document).ready(function () {
                                                    $('[data-toggle="tooltip"]').tooltip();
                                                });
                                            </script>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="panel-footer text-right" ng-init="inficha=true">
                                <a href="Admin#/EditComponente/{{idversion}}/{{ejecutable.componente.Name}}" ng-click="ico_load = 'fa fa-circle-o-notch fa-spin'; blockBtn = true;" ng-init="ico_load = 'fa fa-pencil'; blockBtn= false;" class="btn btn-labeled btn-primary" ng-disabled="formData.estado=='C' || blockBtn">
                                    <span class="btn-label"><span class="{{ico_load}}"></span></span> Editar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="publish-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirmar Publicaci&oacute;n</h4>
                </div>
                <div class="modal-body">
                    Esta opci&oacute;n permite indicar que la versi&oacute;n ya se encuentra lista para ser distribuida
                    a los clientes. Una vez confimada la publicacaci&oacute;n, WinPer Update tomar&aacute; esta acci&oacute;n
                    como una orden para empezar a informar a los clientes que se ha liberado una nueva versi&oacute;n de Winper
                    y que pueden (si lo desean), instalarla en sus estaciones de trabajo.<br /><br />
                    Confirma que desea publicar la Versi&oacute;n ?
                </div>
                <div class="modal-footer">
                    <span style="color: red">{{mensaje}}</span>
                    <button class="btn btn-danger" ng-disabled="formData.estado=='P'" ng-click="Publicar()">Confirmar</button>
                    <button class="btn btn-default" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="delete-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirmar Eliminación</h4>
                </div>
                <div class="modal-body">
                    Confirma que desea eliminar la Versión ?
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" data-dismiss="modal" ng-click="Eliminar()">Confirmar</button>
                    <button class="btn btn-default" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div id="avisocomOk-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Aviso WinperUpdate</h4>
                </div>
                <div class="modal-body">
                    Esta acción no puede ejecutarse debido a que WinperUpdate ha detectado que existen componentes 
                    cuya versión no es válida en comparación con la versión oficial Winper. Por favor revise los componentes 
                    erróneos y vuelva a subirlos.
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

</div>

<input type="hidden" id="Version" value="{{idversion}}" />

<script type="text/javascript">
    $(document).ready(function () {
        $('.input-group.date').datepicker({
            language: "es",
            autoclose: true,
            todayHighlight: true,
        });


        setTimeout(function () {
            $('.input-group.date').datepicker('setDate', $("#fecha").val());
            $('.input-group.date').datepicker('update');
        }, 1500);
    });


</script>